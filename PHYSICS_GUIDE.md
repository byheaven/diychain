# 🌍 物理引擎使用指南

## 概述

DIY Chain 现已集成 Rapier 物理引擎，支持真实的重力和链条晃动效果。

---

## 🎮 如何启用物理效果

### 方法 1：使用界面开关

1. 打开编辑器：http://localhost:3000/editor
2. 点击左上角的 **⚪ 物理：关闭** 按钮
3. 切换为 **🌍 物理：开启**
4. 珠子会立即开始受重力影响下坠和晃动

### 方法 2：默认启用（可选）

编辑 `src/components/editor/canvas-3d.tsx`，第 12 行：

```typescript
const [physicsEnabled, setPhysicsEnabled] = useState(true)  // 改为 true
```

---

## 🔧 物理参数说明

### 重力设置

```typescript
<Physics gravity={[0, -9.81, 0]}>  // 标准地球重力
```

- `[0, -9.81, 0]` - 标准重力（向下）
- `[0, -4.9, 0]` - 月球重力（更慢）
- `[0, -19.6, 0]` - 双倍重力（更快下落）

### 珠子物理属性

每个珠子的物理属性基于 catalog 配置：

```typescript
mass: beadWeight           // 质量（从 weightG 转换）
linearDamping: 0.8         // 线性阻尼（空气阻力）
angularDamping: 0.8        // 角度阻尼（旋转阻力）
restitution: 0.2           // 弹性（碰撞反弹）
```

**调整方法：**

编辑 `src/components/editor/physics-chain.tsx`：

```typescript
<RigidBody
  mass={beadWeight * 2}      // 增加质量 → 下坠更快
  linearDamping={0.5}        // 降低阻尼 → 晃动更久
  restitution={0.8}          // 增加弹性 → 反弹更多
>
```

### 关节连接

珠子之间通过 Ball Joint（球形关节）连接：

```typescript
<BallJoint
  body1={bead1}
  body2={bead2}
  body1Anchor={[0, beadSize/2, 0]}   // 连接点在珠子顶部
  body2Anchor={[0, -beadSize/2, 0]}  // 连接点在珠子底部
/>
```

这样珠子可以自由旋转，像真实的链条一样。

---

## 🎯 使用场景

### 适合启用物理的场景

✅ 展示链条自然下垂效果
✅ 模拟手镯佩戴时的晃动
✅ 互动演示（拖拽珠子）
✅ 营造动态感

### 不适合启用物理的场景

❌ 需要精确排版和截图
❌ 性能敏感场景（移动端）
❌ 需要编辑珠子顺序时
❌ 初次设计阶段

---

## ⚡ 性能影响

### 物理模拟开销

| 珠子数量 | 静态模式 FPS | 物理模式 FPS | 性能影响 |
|---------|------------|------------|---------|
| 5 颗 | 60 | 60 | 无影响 |
| 10 颗 | 60 | 55-60 | 轻微 |
| 20 颗 | 60 | 45-50 | 中等 |
| 50 颗 | 60 | 30-40 | 明显 |

**优化建议：**
- 移动端默认关闭物理
- 只在预览/展示模式启用
- 限制最大珠子数量（< 30）

---

## 🐛 常见问题

### 问题 1：珠子乱飞或穿过地面

**原因：** 碰撞体设置不对

**解决：**
```typescript
// 确保碰撞体大小合适
<CuboidCollider args={[beadSize/2, beadSize/2, beadSize/2]} />
```

### 问题 2：链条断开

**原因：** Ball Joint 未正确连接

**解决：**
确保 `rigidBodyRefs.current[index]` 在创建 Joint 前已设置

### 问题 3：晃动太剧烈

**解决：**
增加阻尼：
```typescript
linearDamping={1.5}   // 增加到 1.5
angularDamping={1.5}
```

### 问题 4：性能下降

**解决：**
1. 减少珠子数量
2. 关闭物理调试：`<Physics debug={false}>`
3. 降低物理更新频率（可选）

---

## 🎨 高级功能（未来）

### 可拖拽珠子
```typescript
<RigidBody
  type="dynamic"
  onDrag={(e) => applyForce(e.force)}
>
```

### 碰撞检测
```typescript
<RigidBody
  onCollisionEnter={(e) => playSound('clink')}
>
```

### 不同链条样式的物理
- 硬链：降低阻尼，增加刚性
- 柔软链：增加阻尼，降低刚性

---

## 📊 对比：静态 vs 物理

| 特性 | 静态模式 | 物理模式 |
|-----|---------|---------|
| 性能 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |
| 真实感 | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| 可控性 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |
| 编辑体验 | ⭐⭐⭐⭐⭐ | ⭐⭐ |
| 移动端 | ✅ | ⚠️ |

**推荐策略：**
- 编辑模式 → 静态
- 预览模式 → 物理
- 分享页面 → 物理（可选）

---

## 🧪 测试步骤

1. **添加 5-10 个珠子**到链条
2. **点击"物理：关闭"切换到"物理：开启"**
3. **观察效果：**
   - ✅ 珠子受重力下坠
   - ✅ 链条自然下垂
   - ✅ 珠子之间保持连接
   - ✅ 轻微晃动后趋于稳定

4. **切换回静态模式**
   - ✅ 珠子恢复到曲线位置
   - ✅ 可以继续编辑

---

**创建时间：** 2025-11-11  
**版本：** 1.0

